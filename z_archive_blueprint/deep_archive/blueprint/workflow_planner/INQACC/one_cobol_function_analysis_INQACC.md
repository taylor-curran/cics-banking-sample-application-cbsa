# INQACC COBOL Program Analysis

## 1. Overview
INQACC is a CICS COBOL program that receives an incoming **account number** (plus sort code) via `DFHCOMMAREA`. It queries the **ACCOUNT** DB2 table (cursor `ACC-CURSOR`) to fetch the matching account row. Key responsibilities:

1. Populate DB2 host-variables from the request.
2. `OPEN`, `FETCH`, and `CLOSE` the cursor, returning the retrieved columns to the COMMAREA.
3. Handle error conditions through CICS `HANDLE ABEND` and custom ABEND processing (`ABNDPROC`).
4. Support a special path (`INQACC-ACCNO = 99999999`) that performs an alternate paragraph (`READ-ACCOUNT-LAST`).

## 2. Data Types
| # | COBOL Field | PIC / Usage | Inferred Java Type | Notes |
|---|-------------|-------------|--------------------|-------|
| 1 | `HV-ACCOUNT-EYECATCHER` | `X(4)` | `String` | Identifier prefix |
| 2 | `HV-ACCOUNT-CUST-NO` | `X(10)` | `String` | Stored numeric but kept as text |
| 3 | `HV-ACCOUNT-SORTCODE` | `X(6)` | `String` | Bank sort-code |
| 4 | `HV-ACCOUNT-ACC-NO` | `X(8)` | `String` | Account number |
| 5 | `HV-ACCOUNT-INT-RATE` | `S9(4)V99 COMP-3` | `BigDecimal` | Packed decimal interest rate |
| 6 | `HV-ACCOUNT-OVERDRAFT-LIM` | `S9(9) COMP` | `Integer` | Binary integer |
| 7 | `HV-ACCOUNT-AVAIL-BAL` | `S9(10)V99 COMP-3` | `BigDecimal` | Packed decimal |
| 8 | `RETURNED-CUST-NO` | `9(10)` | `Long` | Numeric customer id |
| 9 | `RETURNED-SORT-CODE` | `9(6)` | `Integer` | |
|10 | `RETURNED-NUMBER` | `9(8)` | `Integer` | Account number |
|11 | `RETURNED-INTEREST-RATE` | `9(4)V99` | `BigDecimal` | |
|12 | `RETURNED-AVAILABLE-BALANCE` | `S9(10)V99` | `BigDecimal` | |
|13 | `DATA-STORE-TYPE` (88s) | `X` | `enum DataStoreType { DB2, VSAM }` | Redefined by level-88 |
|14 | `WS-POINTER` | `POINTER` | `long` / `java.nio.ByteBuffer` | Addressing helper |

> Mapping rules come from `cobol_java_type_mapping.md` and `naming_structure.md`.

## 3. External Calls (`EXEC CICS` / `EXEC SQL`)
The following calls were detected:

```text
41  EXEC SQL INCLUDE ACCDB2
61  EXEC SQL INCLUDE SQLCA
66  EXEC SQL DECLARE ACC-CURSOR CURSOR FOR ...
210 EXEC CICS HANDLE ABEND LABEL(ABEND-HANDLING)
270 EXEC SQL OPEN ACC-CURSOR
287 EXEC CICS ASSIGN APPLID(…)
307 EXEC CICS ASSIGN PROGRAM(…)
321 EXEC CICS LINK PROGRAM(WS-ABEND-PGM)
335 EXEC CICS ABEND ABCODE('HRAC')
350 EXEC SQL CLOSE ACC-CURSOR
431 EXEC SQL FETCH FROM ACC-CURSOR
584 EXEC CICS RETURN
635 EXEC CICS ASSIGN ABCODE(MY-ABEND-CODE)
682 EXEC CICS SYNCPOINT ROLLBACK
```

*(Line numbers correspond to the original source for quick reference.)*

## 4. Ambiguities & Open Questions
1. Unknown PIC clauses – **none** detected; all PICs conform to standard patterns.
2. Mapping for `POINTER` usage (`WS-POINTER`) – will be represented as `long` but confirm if JNI/struct mapping needed.
3. Many packed decimal fields (`COMP-3`) exceed `Integer` range → map to `BigDecimal`.
4. Special branch `READ-ACCOUNT-LAST` not yet reviewed – confirm business rules.

## 5. Recommended Java Artifacts
1. `AccountDto` – mirrors ACCOUNT table columns (fields #1-#12 above).
2. `AccountEntity` – JPA entity bound to DB2 table `ACCOUNT` (schema‐qualified).
3. `AccountRepository` – Spring Data `CrudRepository<AccountEntity, AccountId>` using composite key (`sortCode`, `accountNumber`).
4. `InquiryAccountService` – orchestrates repository call and maps `AccountEntity → AccountDto`.
5. `InquiryAccountMapper` – MapStruct interface applying naming/type rules.
6. Enum `DataStoreType { DB2, VSAM }` reflects `DATA-STORE-TYPE` 88-level.
7. Unit tests (JUnit) covering successful fetch, not-found, and SQL error paths.

---
Generated by `/one-cobol-program-analysis` on 2025-06-14.
